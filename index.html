<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Viewer</title>

    <script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>

    <style>
        html, body {
            margin: 0;
            height: 100%;
        }

        #viewer {
            width: 100%;
            height: 100vh;
            background: black;
        }
    </style>
</head>

<body>

<div id="viewer"></div>

<script>
var viewer = OpenSeadragon({
    id: "viewer",
    prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
    tileSources: "niv0.dzi",
    showNavigator: false
});

let detailImage = null;

// Ajouter la tuile HD
viewer.addHandler('open', function(){

    viewer.addTiledImage({
        tileSource: "niv1.1.dzi",
        x: 0.1825774438521488,
        y: 0.38635,
        width: 0.04332902059396895,
        opacity: 0,
        preload: true,

        success: function(event){
            detailImage = event.item;
        }
    });

});

// Fade progressif
viewer.addHandler('animation', function(){

    if(!detailImage) return;

    let zoom = viewer.viewport.getZoom(true);

    // ⭐ Apparition plus tôt
    let startFade = 1.6;  // début transition
    let endFade   = 2.1;  // fin transition

    let opacity;

    if(zoom <= startFade){
        opacity = 0;
    }
    else if(zoom >= endFade){
        opacity = 1;
    }
    else{
        // interpolation douce
        opacity = (zoom - startFade) / (endFade - startFade);
    }

    detailImage.setOpacity(opacity);

});
</script>

</body>
</html>


